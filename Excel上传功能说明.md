# Excel 上传功能使用说明

## 功能概述

系统现已支持通过上传 Excel 文件自动提取商品名称并进行批量关键词优化或描述生成。

## 使用步骤

### 1. 切换到上传模式

在关键词优化或产品描述生成页面,点击 **"上传 Excel"** 按钮切换到文件上传模式。

### 2. 上传 Excel 文件

- 点击上传区域选择您的 Excel 文件
- 支持 `.xls` 和 `.xlsx` 两种格式
- 系统会自动读取 **第四列(商品名称列)** 的数据

### 3. 自动提取数据

- 系统会跳过第一行(表头)
- 自动提取第四列中的所有非空单元格数据
- 提取完成后会自动切换回手动输入模式,并将数据填充到输入框

### 4. 开始优化

- 查看提取的数据是否正确
- 点击 **"开始优化"** 或 **"开始生成"** 按钮
- 等待 AI 处理完成

### 5. 导出结果

- 查看优化后的结果
- 可导出为 Excel 表格或 JPG 图片

## 表格格式要求

### 标准格式

```
| 列1 | 列2 | 列3 | 商品名称 | 列5 | ... |
|-----|-----|-----|----------|-----|-----|
| ... | ... | ... | 卤鸭板肠 | ... | ... |
| ... | ... | ... | 柠檬茶   | ... | ... |
| ... | ... | ... | 烤鱼     | ... | ... |
```

### 重要说明

1. **列位置**: 商品名称必须在第四列(列索引为3)
2. **表头**: 第一行会被自动跳过
3. **空值处理**: 空白单元格会被自动忽略
4. **数据类型**: 所有单元格内容会被转换为文本

## 示例文件

您的文件 `4a1cbe77f4bfd3fb85ec73b98852c3b948640.xls` 符合标准格式,可直接上传使用。

## 技术特性

### 支持的功能

- ✅ 自动识别 Excel 格式(.xls 和 .xlsx)
- ✅ 智能跳过表头行
- ✅ 自动过滤空白数据
- ✅ 实时解析进度提示
- ✅ 错误提示和处理

### 优化建议

- 文件大小建议不超过 5MB
- 单次上传建议不超过 500 个商品
- 确保商品名称列没有合并单元格
- 确保数据格式为文本或通用格式

## 常见问题

### Q: 为什么提取不到数据?

**A**: 请检查:
1. 商品名称是否在第四列
2. 第一行是否为表头
3. 单元格是否为空
4. 文件格式是否为 .xls 或 .xlsx

### Q: 可以更改读取的列吗?

**A**: 可以。在代码中找到 `ExcelUploader` 组件,修改 `columnIndex` 参数:
- 第一列: `columnIndex={0}`
- 第二列: `columnIndex={1}`
- 第三列: `columnIndex={2}`
- 第四列: `columnIndex={3}` (默认)

### Q: 如何跳过更多行?

**A**: 在 `readExcelColumn` 函数中修改 `startRow` 参数:
```typescript
await readExcelColumn(file, 3, 2); // 从第三行开始读取(跳过前两行)
```

### Q: 上传失败怎么办?

**A**: 请尝试:
1. 检查文件是否损坏
2. 使用较新版本的 Excel 保存文件
3. 将文件另存为 .xlsx 格式
4. 清除浏览器缓存后重试

## 技术实现

### 核心函数

**`readExcelColumn()`** - 位于 `utils/export.ts:246`
- 使用 `xlsx` 库解析 Excel 文件
- 支持二进制和 XML 格式
- 返回指定列的字符串数组

**`ExcelUploader`** - 位于 `components/ExcelUploader.tsx`
- React 组件,提供文件上传界面
- 自动触发文件解析
- 回调函数传递提取的数据

### 数据流

```
用户上传文件
  ↓
FileReader 读取二进制数据
  ↓
XLSX.read() 解析工作簿
  ↓
提取指定列数据
  ↓
过滤空值并转换为字符串数组
  ↓
回调函数传递数据到父组件
  ↓
自动填充到输入框
  ↓
用户点击优化按钮
```

## 后续优化方向

### 计划功能

- [ ] 支持自定义选择列
- [ ] 支持多列批量处理
- [ ] 支持 CSV 格式
- [ ] 添加数据预览功能
- [ ] 支持拖拽上传
- [ ] 历史文件记录

### 性能优化

- [ ] 大文件分批处理
- [ ] 添加处理进度条
- [ ] 优化内存占用
- [ ] 支持断点续传

---

**版本**: 1.0.0
**更新日期**: 2025-10-13
**开发者**: Claude Code
