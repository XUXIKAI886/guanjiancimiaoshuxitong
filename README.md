# 产品优化助手

基于 AI 技术的智能产品关键词优化和描述生成系统,专为外卖、电商等行业设计。

## 项目简介

产品优化助手是一个强大的 AI 驱动工具,可以帮助您快速优化产品关键词和生成产品描述。系统支持批量处理,并提供 Excel 和 JPG 图片两种导出格式。

### 核心功能

- **双平台支持**: 支持美团(带表情)和饿了么(无表情)两种优化模式
- **关键词优化**: 批量优化产品关键词,自动添加四字卖点
- **产品描述生成**: 根据产品名称自动生成吸引人的描述文案
- **Excel 文件上传**: 支持上传 Excel 文件,自动提取商品名称列(支持饿了么格式)
- **智能分批处理**: 大批量数据自动分批处理,稳定高效
- **双列对比**: 清晰展示优化前后的对比效果
- **多格式导出**: 支持导出为 Excel 表格和 JPG 图片
- **信息侧边栏**: 显示服务说明文案,支持一键复制
- **响应式设计**: 完美适配各种屏幕尺寸

## 技术栈

- **框架**: Next.js 15 (App Router)
- **语言**: TypeScript
- **样式**: Tailwind CSS
- **图标**: Lucide React
- **Excel 导出**: xlsx
- **图片导出**: 原生 Canvas API
- **AI 模型**: Gemini 2.5 Flash Lite

## 安装指南

### 环境要求

- Node.js 18.0 或更高版本
- npm 或 yarn 包管理器

### 安装步骤

1. 克隆项目

```bash
git clone <repository-url>
cd product-optimizer
```

2. 安装依赖

```bash
npm install
```

3. 配置环境变量

**本地开发**:创建 `.env.local` 文件并填入配置:

```env
NEXT_PUBLIC_API_BASE_URL=https://jeniya.top/v1/chat/completions
NEXT_PUBLIC_API_MODEL=gemini-2.5-flash-lite
NEXT_PUBLIC_API_KEY=your-api-key-here
```

**生产部署**:创建 `.env.production` 文件(GitHub Pages 部署需要):

```env
NEXT_PUBLIC_API_BASE_URL=https://jeniya.top/v1/chat/completions
NEXT_PUBLIC_API_MODEL=gemini-2.5-flash-lite
NEXT_PUBLIC_API_KEY=your-api-key-here
```

4. 启动开发服务器

```bash
npm run dev
```

5. 打开浏览器访问 [http://localhost:3000](http://localhost:3000)

## 使用说明

### 平台选择

系统支持美团和饿了么两种平台:

1. **美团模式**: 关键词带表情符号(如 🍗🍱)
2. **饿了么模式**: 关键词不带表情符号(纯文字)

在开始处理前,请先选择对应的平台。

### Excel 文件上传(推荐)

系统支持直接上传 Excel 文件,自动提取商品名称进行批量处理:

1. 选择平台(美团/饿了么)
2. 选择"关键词优化"或"产品描述生成"标签页
3. 点击"上传 Excel"按钮
4. 选择您的 Excel 文件(.xls 或 .xlsx)
5. 系统自动读取第四列"商品名称"的数据
6. 提取完成后自动填充到输入框
7. 点击"开始优化"或"开始生成"
8. 可导出为 Excel 表格或 JPG 图片

**Excel 格式要求**:
- 美团格式: 第一行为表头(会自动跳过)
- 饿了么格式: 前两行为标题和表头(从第3行开始读取)
- 商品名称必须在第四列(D列)
- 支持 .xls 和 .xlsx 格式

### 关键词优化(手动输入)

1. 选择"关键词优化"标签页
2. 点击"手动输入"按钮
3. 在输入框中输入产品关键词,每行一个
4. 支持套餐格式,用 `+` 连接多个产品(例如: 卤鸭板肠(小份)+卤菜(小份))
5. 点击"开始优化"按钮
6. 查看优化结果,系统会添加表情符号和四字卖点
7. 可导出为 Excel 表格或 JPG 图片

**输入示例:**
```
卤鸭板肠(小份)
柠檬茶(大杯)
卤鸭板肠(小份)+卤菜(小份)
```

**输出示例:**
```
卤鸭板肠(小份)【🍗卤香四溢】
柠檬茶(大杯)【🍹清爽解腻】
卤鸭板肠(小份)+卤菜(小份)【🍱组合丰富】
```

### 产品描述生成

1. 选择"产品描述生成"标签页
2. 在输入框中输入产品名称,每行一个
3. 点击"开始生成"按钮
4. 查看生成的产品描述
5. 可导出为 Excel 表格或 JPG 图片

**输入示例:**
```
麻辣小龙虾
招牌烤鱼
椒盐排骨
```

## 项目结构

```
product-optimizer/
├── app/                    # Next.js App Router 页面
│   ├── page.tsx           # 主页面
│   ├── layout.tsx         # 布局组件
│   └── globals.css        # 全局样式
├── components/            # React 组件
│   └── ProductOptimizer.tsx  # 优化器组件
├── lib/                   # 核心功能库
│   ├── api.ts            # AI API 调用
│   └── prompts.ts        # 提示词配置
├── utils/                 # 工具函数
│   └── export.ts         # 导出功能
├── types/                 # TypeScript 类型定义
│   └── index.ts          # 类型定义
└── public/               # 静态资源
```

## API 配置说明

系统使用 OpenAI 兼容的 API 接口,默认配置如下:

- **Base URL**: https://jeniya.top/v1/chat/completions
- **模型**: gemini-2.5-flash-lite
- **API Key**: 需要在 `.env.local` 中配置

如需更换其他 AI 服务商,只需修改环境变量即可。

## 关键算法说明

### 智能分批处理策略

系统采用智能分批处理策略,确保大批量数据处理的稳定性:

#### 批处理配置
- **关键词优化**: 30条/批
- **产品描述**: 20条/批
- **批次延迟**: 1秒间隔,避免 API 限流
- **max_tokens**: 8000(优化后更稳定)

#### 技术优势
- ✅ **稳定性高**: 较小批次确保输出完整
- ✅ **容错机制**: 单批次失败不影响其他批次
- ✅ **实时反馈**: 控制台显示处理进度
- ✅ **自动修复**: 输出行数不匹配时自动补全或截断
- ✅ **无限制**: 理论上可处理任意数量数据

#### 处理能力
- **最佳性能**: 30条关键词或20条描述以内
- **大批量**: 100+ 条自动分批处理
- **超大批量**: 200+ 条稳定处理,约需1-2分钟

### 提示词工程

项目包含三套专业的提示词:

1. **美团关键词优化提示词** (`lib/prompts.ts:KEYWORD_PROMPT_MEITUAN`)
   - 角色定位: 产品关键词优化助手
   - 核心能力: 提炼四字卖点 + 匹配表情符号
   - 特殊处理: 支持套餐格式(+连接符)
   - 输出格式: 产品名称【表情+四字卖点】

2. **饿了么关键词优化提示词** (`lib/prompts.ts:KEYWORD_PROMPT_ELEME`)
   - 角色定位: 产品关键词优化助手
   - 核心能力: 提炼四字卖点(无表情符号)
   - 特殊处理: 支持套餐格式(+连接符)
   - 输出格式: 产品名称【四字卖点】

3. **描述生成提示词** (`lib/prompts.ts:DESCRIPTION_PROMPT`)
   - 角色定位: 菜品描述生成助手
   - 核心能力: 撰写吸引人的产品描述
   - 限制条件: 避免极限词,符合广告法
   - 输出格式: 直接输出描述文字

#### 提示词核心约束
所有提示词都强制执行 **输入行数 = 输出行数** 的一对一对应规则,确保不会出现跳过、遗漏或错位现象。

## 构建和部署

### 本地构建

```bash
npm run build
npm start
```

### 部署到 Vercel

1. 将项目推送到 GitHub
2. 在 Vercel 导入项目
3. 配置环境变量
4. 自动部署

### 部署到 GitHub Pages

项目已配置 GitHub Actions 自动部署:

1. 将代码推送到 GitHub 仓库的 `master` 分支
2. 创建 `.env.production` 文件并推送到仓库:
   ```bash
   git add -f .env.production
   git commit -m "Add production environment variables"
   git push
   ```
3. 在仓库 Settings > Pages 中启用 Pages 功能
4. 选择 `gh-pages` 分支作为部署源
5. GitHub Actions 会自动构建并部署

**注意**:
- `.env.production` 需要强制添加 (`git add -f`)
- API Key 会被编译到静态文件中,请注意安全性
- 每次推送到 master 分支都会自动触发部署

## 开发说明

### 添加新功能

1. 在 `components/` 目录创建新组件
2. 在 `lib/` 目录添加业务逻辑
3. 在 `types/` 目录定义类型
4. 更新主页面引入新功能

### 修改提示词

编辑 `lib/prompts.ts` 文件,调整提示词内容以优化输出效果。

### 自定义样式

项目使用 Tailwind CSS,可在组件中直接使用工具类,或在 `tailwind.config.ts` 中自定义主题。

## 常见问题

### Q: API 调用失败怎么办?

A: 请检查以下几点:
- 环境变量配置是否正确
- API Key 是否有效
- 网络连接是否正常
- API 服务商是否有使用限制

### Q: 导出的图片不清晰?

A: 系统使用原生 Canvas API 直接绘制表格,默认 `scale: 2` 已提供高清晰度。如需调整,可在 `utils/export.ts` 中修改 canvas 尺寸参数。

### Q: 图片导出失败怎么办?

A: 系统已采用原生 Canvas API 方案,完全避免了 CSS 颜色解析问题。如仍有问题,请检查浏览器控制台的错误信息。

### Q: 如何更换其他 AI 模型?

A: 修改 `.env.local` 中的 `NEXT_PUBLIC_API_MODEL` 和 `NEXT_PUBLIC_API_BASE_URL` 即可。

### Q: Excel 上传后找不到数据?

A: 请检查:
- 商品名称是否在第四列
- 第一行是否为表头
- 单元格是否为空
- 文件格式是否为 .xls 或 .xlsx

### Q: 大批量数据处理很慢?

A: 这是正常现象:
- 系统会自动分批处理(30条/批或20条/批)
- 每批间隔 1 秒,避免 API 限流
- 100条数据约需 10-15 秒
- 200条数据约需 1-2 分钟
- 可在浏览器控制台(F12)查看实时进度

### Q: 出现产品描述错位怎么办?

A: 系统已采取多重保障措施:
- 提示词强制要求 1:1 行数对应
- 输出验证:自动检测行数不匹配
- 自动修复:补全缺失或截断多余
- 如仍有问题,请减小批量(建议≤100条)

### Q: AI 输出了提示词内容怎么办?

A: 已修复此问题:
- v2.1 版本移除了提示词中的视觉装饰符号
- 简化了提示词结构
- 如果使用旧版本,请更新到最新代码

### Q: 侧边栏文案如何使用?

A: 两种复制方式:
- 点击右上角"复制"按钮
- 直接点击文案内容
- 复制后可粘贴到任意位置

## 🖥️ Tauri 桌面应用支持

### 环境兼容性

本项目现已支持**双环境运行**：

✅ **浏览器环境** - 传统 Web 应用方式
✅ **Tauri 桌面应用** - 呈尚策划工具箱集成

### 导出功能

所有导出功能（Excel 和图片）都已适配 Tauri 桌面应用：

**浏览器环境**:
- 使用浏览器原生下载机制
- 文件直接下载到浏览器默认下载目录

**Tauri 桌面应用**:
- 弹出文件保存对话框
- 用户自由选择保存位置
- 支持中文路径和文件名
- 保存成功后显示文件位置

### 测试工具

项目提供了独立的测试页面，可用于验证 Tauri 下载功能：

```bash
# 在浏览器中打开测试页面
open test-tauri-download.html
```

测试页面功能：
- ✅ 环境自动检测
- ✅ Dialog API 测试
- ✅ 图片下载测试
- ✅ 文本文件下载测试
- ✅ 详细日志输出

### 技术实现

核心修改文件: `utils/export.ts`

**关键技术点**:
1. 自动环境检测 (`isTauriEnvironment()`)
2. Excel 导出双环境支持
3. 图片导出双环境支持
4. Tauri API 标准调用格式
5. 完整错误处理机制

详细文档: 查看 `Tauri集成说明.md`

---

## 版本更新

### v2.2 (2025-01-12)
- ✅ **重大更新**: 新增 Tauri 桌面应用支持
- ✅ Excel 导出支持浏览器和 Tauri 双环境
- ✅ 图片导出支持浏览器和 Tauri 双环境
- ✅ 添加环境自动检测功能
- ✅ 添加 Tauri 下载测试页面
- ✅ 完善错误处理和用户提示

### v2.1 (2025-10-13)
- ✅ 新增双平台支持(美团/饿了么)
- ✅ 修复 AI 输出提示词内容的问题
- ✅ 优化批处理策略(30条/20条)
- ✅ 降低 max_tokens 到 8000 提升稳定性
- ✅ 支持饿了么 Excel 格式(从第3行开始)
- ✅ 优化侧边栏布局(280px宽度)
- ✅ 优化响应式设计(适配小屏幕)
- ✅ 增强输出验证和自动修复机制

### v2.0 (2025-10-12)
- ✅ 新增 Excel 文件上传功能
- ✅ 新增智能分批处理
- ✅ 新增信息侧边栏
- ✅ 支持无限量数据处理
- ✅ 优化错误处理和日志

### v1.0 (2025-10-11)
- ✅ 基础关键词优化功能
- ✅ 产品描述生成功能
- ✅ Excel 和图片导出
- ✅ 批量处理支持

## 许可证

MIT License

## 联系方式

如有问题或建议,欢迎提交 Issue 或 Pull Request。

